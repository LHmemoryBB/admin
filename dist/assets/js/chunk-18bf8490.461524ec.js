(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-18bf8490"],{"0c1b":function(t,e,a){},"3c42":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-main",{staticClass:"bg table_wrap comtabel_t"},[r("el-form",{staticClass:"form p_4",attrs:{"label-position":"right",model:t.query,"label-width":"120"}},[r("el-row",{staticClass:"rows row1"},[r("el-col",{staticClass:"el_form_search_wrap",attrs:{xs:24,sm:24,lg:8}},[r("el-form-item",{attrs:{label:"景点名称"}},[r("el-input",{model:{value:t.query.attraction_name,callback:function(e){t.$set(t.query,"attraction_name",e)},expression:"query.attraction_name"}})],1)],1),r("el-col",{staticClass:"el_form_search_wrap",attrs:{xs:24,sm:24,lg:8}},[r("el-form-item",{attrs:{label:"景点城市"}},[r("el-input",{model:{value:t.query.attraction_cities,callback:function(e){t.$set(t.query,"attraction_cities",e)},expression:"query.attraction_cities"}})],1)],1),r("el-col",{staticClass:"el_form_search_wrap",attrs:{xs:24,sm:24,lg:8}},[r("el-form-item",{attrs:{label:"景点地址"}},[r("el-input",{model:{value:t.query.attraction_address,callback:function(e){t.$set(t.query,"attraction_address",e)},expression:"query.attraction_address"}})],1)],1),r("el-col",{staticClass:"el_form_search_wrap",attrs:{xs:24,sm:24,lg:8}},[r("el-form-item",{attrs:{label:"用户姓名"}},[r("el-input",{model:{value:t.query.user_name,callback:function(e){t.$set(t.query,"user_name",e)},expression:"query.user_name"}})],1)],1),r("el-col",{staticClass:"el_form_search_wrap",attrs:{xs:24,sm:24,lg:8}},[r("el-form-item",{attrs:{label:"支付状态"}},[r("el-select",{model:{value:t.query.pay_state,callback:function(e){t.$set(t.query,"pay_state",e)},expression:"query.pay_state"}},[r("el-option",{attrs:{value:""}},[t._v("全部")]),r("el-option",{attrs:{value:"未支付"}},[t._v("未支付")]),r("el-option",{attrs:{value:"已支付"}},[t._v("已支付")])],1)],1)],1)],1),r("el-row",{staticClass:"rows row2"},[r("el-col",{staticClass:"search_btn_wrap search_btns",attrs:{xs:24,sm:24,lg:24}},[r("el-col",{staticClass:"search_btn_1 search_btn_wrap_1 btns",attrs:{xs:24,sm:10,lg:8}},[r("el-button",{staticClass:"search_btn_find",attrs:{type:"primary"},on:{click:function(e){return t.search()}}},[t._v("查询")]),r("el-button",{staticClass:"search_btn_reset",staticStyle:{"margin-right":"74px"},on:{click:function(e){return t.reset()}}},[t._v("重置")]),"管理员"==t.user_group||t.$check_action("/attraction_reservation/table","del")||t.$check_action("/attraction_reservation/view","del")?r("el-button",{staticClass:"search_btn_del",attrs:{type:"danger"},on:{click:function(e){return t.delInfo()}}},[t._v("删除")]):t._e()],1)],1)],1)],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,id:"dataTable"},on:{"selection-change":t.selectionChange,"sort-change":t.$sortChange}},[r("el-table-column",{attrs:{fixed:"",type:"selection","tooltip-effect":"dark",width:"55"}}),"管理员"==t.user_group||t.$check_field("get","attraction_name")?r("el-table-column",{attrs:{prop:"attraction_name",label:"景点名称","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),"管理员"==t.user_group||t.$check_field("get","attraction_cities")?r("el-table-column",{attrs:{prop:"attraction_cities",label:"景点城市","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),"管理员"==t.user_group||t.$check_field("get","attraction_address")?r("el-table-column",{attrs:{prop:"attraction_address",label:"景点地址","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),"管理员"==t.user_group||t.$check_field("get","admission_price")?r("el-table-column",{attrs:{prop:"admission_price",label:"门票价格","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),"管理员"==t.user_group||t.$check_field("get","opening_hours")?r("el-table-column",{attrs:{prop:"opening_hours",label:"开放时间","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),"管理员"==t.user_group||t.$check_field("get","appointment_points")?r("el-table-column",{attrs:{prop:"appointment_points",label:"预约积分","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),"管理员"==t.user_group||t.$check_field("get","regular_users")?r("el-table-column",{attrs:{prop:"regular_users",label:"普通用户","min-width":"200"},on:{"sort-change":t.$sortChange},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.get_user_regular_users(e.row["regular_users"]))+" ")]}}],null,!1,1966286131)}):t._e(),"管理员"==t.user_group||t.$check_field("get","user_name")?r("el-table-column",{attrs:{prop:"user_name",label:"用户姓名","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),"管理员"==t.user_group||t.$check_field("get","number_of_reservations")?r("el-table-column",{attrs:{prop:"number_of_reservations",label:"预约人数","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),"管理员"==t.user_group||t.$check_field("get","appointment_time")?r("el-table-column",{attrs:{prop:"appointment_time",label:"预约时间","min-width":"200"},on:{"sort-change":t.$sortChange},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$toTime(e.row["appointment_time"],"yyyy-MM-dd"))+" ")]}}],null,!1,3506829463)}):t._e(),"管理员"==t.user_group||t.$check_field("get","appointment_amount")?r("el-table-column",{attrs:{prop:"appointment_amount",label:"预约金额","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),"管理员"==t.user_group||t.$check_field("get","obtainable_points")?r("el-table-column",{attrs:{prop:"obtainable_points",label:"可得积分","min-width":"200"},on:{"sort-change":t.$sortChange}}):t._e(),r("el-table-column",{attrs:{label:"支付状态",prop:"pay_state"}}),r("el-table-column",{attrs:{sortable:"",prop:"create_time",label:"创建时间","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$toTime(e.row["create_time"],"yyyy-MM-dd hh:mm:ss"))+" ")]}}])}),r("el-table-column",{attrs:{sortable:"",prop:"update_time",label:"更新时间","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$toTime(e.row["update_time"],"yyyy-MM-dd hh:mm:ss"))+" ")]}}])}),"管理员"==t.user_group||t.$check_action("/attraction_reservation/table","set")||t.$check_action("/attraction_reservation/view","set")||t.$check_action("/attraction_reservation/view","get")||t.$check_action("/申请退票/table","add")||t.$check_action("/申请退票/view","add")?r("el-table-column",{attrs:{fixed:"right",label:"操作","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("div",{staticClass:"view_a"},["管理员"==t.user_group||t.$check_action("/attraction_reservation/table","set")||t.$check_action("/attraction_reservation/view","set")||t.$check_action("/attraction_reservation/view","get")?r("router-link",{staticClass:"e-button el-button--small is-plain el-button--success",staticStyle:{margin:"5px !important"},attrs:{to:"./view?"+t.field+"="+e.row[t.field],size:"small"}},[r("span",[t._v("详情")])]):t._e(),"管理员"==t.user_group||t.$check_action("/tourist_attraction_ticket_refund/table","add")||t.$check_action("/tourist_attraction_ticket_refund/view","add")?r("el-button",{staticClass:"e-button el-button--small is-plain el-button--default",staticStyle:{margin:"5px !important"},attrs:{size:"small"},on:{click:function(a){return t.to_table(e.row,"/tourist_attraction_ticket_refund/view")}}},[r("span",[t._v("申请退票")])]):t._e(),"未支付"!==e.row.pay_state||"管理员"!=t.user_group&&!t.$check_pay("/attraction_reservation/table")?t._e():r("el-button",{staticClass:"el-button el-button--small is-plain el-button--default",staticStyle:{margin:"5px !important"},attrs:{size:"small"},on:{click:function(a){return t.openPayModal(e.row)}}},[r("span",[t._v("支付")])])],1)]}}],null,!1,1610424155)}):t._e()],1),r("div",{staticClass:"mt text_center"},[r("el-pagination",{attrs:{"current-page":t.query.page,"page-sizes":[7,10,30,100],"page-size":t.query.size,layout:"total, sizes, prev, pager, next, jumper",total:t.count},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),r("el-dialog",{attrs:{title:"沙箱支付",visible:t.payModalVisible,width:"500px"},on:{"update:visible":function(e){t.payModalVisible=e}}},[r("div",{staticStyle:{width:"80%",margin:"0 auto"}},[r("div",{staticStyle:{width:"60%",margin:"30px auto"}},[r("el-image",{staticStyle:{width:"100%"},attrs:{src:t.pay_qrcode}},[r("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[r("img",{staticStyle:{width:"90px",height:"90px"},attrs:{src:a("84f9")}})])])],1),r("div",{staticStyle:{width:"80%",margin:"0 auto"}},[r("div",{staticStyle:{width:"100%","background-color":"#409EFF",color:"white","font-size":"14px","text-align":"center","line-height":"40px",cursor:"pointer"},on:{click:function(e){return t.submitPay()}}},[t._v("确认支付 ")])])])]),t.showModal?r("div",{staticClass:"modal_wrap"},[r("div",{staticClass:"modal_box"},[r("p",{staticClass:"modal_box_title"},[t._v("重要提醒")]),r("p",{staticClass:"modal_box_text"},[t._v("当前有数据达到预警值！")]),r("div",{staticClass:"btn_box"},[r("span",{on:{click:t.closeModal}},[t._v("取消")]),r("span",{on:{click:t.closeModal}},[t._v("确定")])])])]):t._e()],1)},s=[],i=(a("96cf"),a("1da1")),o=a("c6e7"),n={mixins:[o["a"]],data:function(){return{showModal:!1,url_get_list:"~/api/attraction_reservation/get_list?like=0",url_del:"~/api/attraction_reservation/del?",field:"attraction_reservation_id",query:{size:7,page:1,attraction_name:"",attraction_cities:"",attraction_address:"",user_name:"",pay_state:"",login_time:"",create_time:"",orderby:"create_time desc"},list:[],payModalVisible:!1,pay_obj:{id:""},pay_qrcode:"",list_user_regular_users:[]}},methods:{closeModal:function(){this.showModal=!1},get_list_before:function(t){var e=this.user.user_group;if("管理员"!=e){var a="(";"普通用户"==e&&(a+="regular_users = "+this.user.user_id+" or "),a.length>1&&(a=a.substr(0,a.length-4),a+=")",t["sqlwhere"]=a)}return t},get_list_user_regular_users:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$get("~/api/user/get_list?user_group=普通用户");case 2:a=e.sent,a.result&&a.result.list?t.list_user_regular_users=a.result.list:a.error&&console.error(a.error);case 4:case"end":return e.stop()}}),e)})))()},get_user_regular_users:function(t){var e=this.list_user_regular_users.getObj({user_id:t}),a="";return e&&(a=e.nickname+"-"+e.username),a},openPayModal:function(t){var e=this;this.pay_obj.id=t.attraction_reservation_id,this.payModalVisible=!0;var a=t.attraction_name,r=t.appointment_amount;this.$get("~/api/attraction_reservation/alipay?goods_name="+a+"&pay_money="+r,{},(function(t){t.result?(e.pay_qrcode="https://api.mhjz1.cn/qr/?size=250&text="+t.result,e.payModalVisible=!0):t.error&&console.error(t.error)}))},submitPay:function(){var t=this,e=this.$toUrl(this.query,"~/api/attraction_reservation/set?attraction_reservation_id="+this.pay_obj.id),a={pay_state:"已支付"};this.$post(e,a,(function(e,a){console.log("提交结果：",e),e.result?(t.$toast("支付成功！","success"),t.payModalVisible=!1,t.get_list()):e.error&&t.$toast(e.error.message,"danger")}))}},created:function(){this.get_list_user_regular_users()}},l=n,c=(a("8f78"),a("2877")),_=Object(c["a"])(l,r,s,!1,null,null,null);e["default"]=_.exports},"8f78":function(t,e,a){"use strict";a("0c1b")}}]);